<div class="container">
  <div class="row">
    <p id="notice">
      <%= notice %>
    </p>
    <h2 class="text-center mx-auto orange-underline">　投稿詳細　</h2>
    </div>
      <div class="row">
      <div class="col-md-7">

        <div class="card" style="width: 40rem;">
        <%= image_tag @post.get_image(600,600) %>
        </div>
      </div>

      <div class="col-md-5">
        <table class="table table-hover table-inverse">
          <tr>
          <th>Title</th>
          <th><%= @post.body %></th>
          </tr>
          <th>Opinion</th>

        </table>
      </div>
          </div>

          <h5>住所</h5>
            <p><%= @post.address %></p>

            <!-- Googleマップ表示エリア(地図を表示) -->
            <div id='map'></div>

            <style>
            #map {
              height: 600px;
              width: 600px;
            }
            </style>

            <!-- Googleマップ表示用の Javascript -->
            <script>
              function initMap(){
                // 地図の位置情報(緯度・経度)を取得
                let mapPosition = {lat: <%= @post.latitude || 0 %> , lng: <%= @post.longitude || 0 %> };
                let map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 15,
                  center: mapPosition
                });
                let transitLayer = new google.maps.TransitLayer();
                transitLayer.setMap(map);

                let contentString = '【住所】<%= @post.address %>';
                let infowindow = new google.maps.InfoWindow({
                  content: contentString
                });

                let marker = new google.maps.Marker({
                  position: mapPosition,
                  map: map,
                  title: contentString
                });

                marker.addListener('click', function(){
                  infowindow.open(map, marker);
                });
              }
              </script>

              <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>

         <% @post_tags.each do |tag| %>
         <%= link_to tag.name, posts_path(tag_id: tag.id) %>
         <%= "(#{tag.posts.count})" %>
         <% end %>
        </tbody>
         <% if @post.liked_by?(current_user) %>
            <p>
              <%= link_to post_likes_path(@post), method: :delete do %>
                ♥<%= @post.likes.count %> いいね
              <% end %>
            </p>
            <% else %>
            <p>
              <%= link_to post_likes_path(@post), method: :post do %>
                ♡<%= @post.likes.count %> いいね
              <% end %>
            </p>
          <% end %>

          <h2>コメント一覧</h2>
          <% @post.comments.each do |comment| %>
            <%= comment.comment_content %>
          <% end %>

          <h2>コメントする</h2>
            <%= form_with model:[@post, @comment], method: :post do |f| %>
            <%= f.text_area :comment_content, placeholder: "コメントをここに"  %>
            <%= f.hidden_field :post_id, value: @post.id %>
            <%= f.submit 'コメントする' %>
          <% end %>





  </div>
</div>
